<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gestión de Órdenes - Servicios Mecánicos RCV</title>

  <link rel="stylesheet" href="css/estilos.css" />
  <script>(function(){try{if(!localStorage.getItem('API_BASE'))localStorage.setItem('API_BASE','http://localhost:3001/api');}catch(e){}})();</script>

  <script src="js/common.js" defer></script>
  <script src="js/global.js" defer></script>
  <script src="js/panel-links.js" defer></script>
  <script src="js/topbar.js" defer></script>
  <script src="js/toast.js" defer></script>
  <script src="js/perms.js" defer></script>
  <script src="js/logout.js" defer></script>

  <script src="js/gestion-ordenes.js" defer></script>
</head>
<body data-page-key="ordenes">
  <div id="topbarContainer"></div>

  <main class="container container--fluid">
    <h1>Gestión y supervisión de órdenes</h1>

    <section class="card">
      <div class="toolbar" style="gap:8px;flex-wrap:wrap">
        <input id="q" placeholder="Buscar por número, placa o cliente…" />
        <select id="f_estado">
          <option value="">Todos los estados</option>
          <option value="abierta">Abierta</option>
          <option value="en_proceso">En proceso</option>
          <option value="esperando_piezas">Esperando piezas</option>
          <option value="finalizada">Finalizada</option>
          <option value="entregada">Entregada</option>
          <option value="cancelada">Cancelada</option>
        </select>
        <select id="f_asignado"><option value="">Todos los técnicos</option></select>
        <button class="btn-ghost" id="btnBuscar">Buscar</button>
        <button class="btn-ghost" id="btnRefrescar">Refrescar</button>
        <a href="crear-orden.html" class="btn-primary">+ Nueva orden</a>
      </div>
    </section>

    <!-- KANBAN -->
    <section class="card">
      <div id="kanban" class="kanban" style="display:grid;grid-template-columns:repeat(5,1fr);gap:12px;overflow:auto">
        <!-- columnas se llenan por JS -->
      </div>
    </section>

    <!-- DIALOG VER -->
    <dialog id="dlgOrden" style="width:min(860px,96vw);border:none;border-radius:12px;padding:0;box-shadow:var(--shadow)">
      <div class="card" style="margin:0;border:none;box-shadow:none">
        <div class="card-header">
          <h2 id="dlgOrdenTitulo" style="margin:0">Orden</h2>
          <div class="toolbar">
            <button id="btnDlgPrint" class="btn-ghost" type="button">Imprimir</button>
            <button id="btnDlgPdf" class="btn-ghost" type="button">Guardar PDF</button>
            <button id="btnCerrarDlgOrden" class="btn-ghost" type="button">Cerrar</button>
          </div>
        </div>
        <div id="dlgOrdenBody" style="max-height:65vh;overflow:auto;padding:8px 12px 16px 12px"></div>
      </div>
    </dialog>
  </main>

  <div class="toast-container" aria-live="polite" aria-atomic="true"></div>
  <script src="js/theme.js"></script>
</body>
</html>
